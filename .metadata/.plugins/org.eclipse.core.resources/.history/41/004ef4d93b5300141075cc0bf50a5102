package com.elijahfreestone.project3android;

import java.util.List;

import android.app.AlertDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.content.DialogInterface.OnClickListener;
import android.util.Log;
import android.widget.Toast;

import com.parse.DeleteCallback;
import com.parse.FindCallback;
import com.parse.ParseException;
import com.parse.ParseObject;
import com.parse.ParseQuery;

public class DataManager {
	static String TAG = "DataManager";
	Context myContext = MainActivity.myContext;
	
	//Delete item from list once confirmed with alert dialog 
    static void deleteItem(int positionSelected) {
    	//Pass position to Final var -1 to account for 0 based
    	final int deleteItemPosition = positionSelected - 1;
    	//Create dialog to confirm delete
    	AlertDialog.Builder deleteDialog = new AlertDialog.Builder(MainActivity.myContext);
    	deleteDialog.setTitle("Delete Item?");
    	deleteDialog.setMessage("Are you sure you want to delete this item?");
    	deleteDialog.setPositiveButton("YES", new OnClickListener() {
			
			@Override
			public void onClick(DialogInterface dialog, int which) {
				//Query parse for item
				ParseQuery<ParseObject> deleteQuery = ParseQuery.getQuery("newItem");
				//Remove item from listview
				deleteQuery.findInBackground(new FindCallback<ParseObject>() {

					@Override
					public void done(List<ParseObject> itemsList, ParseException e) {
						if (e == null) {
							//Delete item from parse
							itemsList.get(deleteItemPosition).deleteInBackground(new DeleteCallback() {

								@Override
								public void done(ParseException arg0) {
									if (arg0 == null) {
										Toast.makeText(MainActivity.myContext,"Item Successfully Deleted!", Toast.LENGTH_LONG).show();
										//Clear item arraylist and repop listview
										MainActivity.parseArrayList.clear();
										//MainActivity.queryParseForItems();
										MainActivity.listAdapter.notifyDataSetChanged();
										//itemListView.setEnabled(true);
									} else {
										Toast.makeText(MainActivity.myContext,"An error occured, please try again.", Toast.LENGTH_LONG).show();
									}
								}
							}); //deleteInBackground close
						}
					}
				}); //findInBackground close
			}
		});
    	deleteDialog.setNegativeButton("NO", new OnClickListener() {
			
			@Override
			public void onClick(DialogInterface dialog, int which) {
				Log.i(TAG, "Delete Canceled");
			}
		});  
    	
    	
    	deleteDialog.show();
    } //deleteItem close
	

}
